<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kinaa Education - Sign In / Sign Up</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDWZWtD4BVA3_U3kuit8MRRVTAfL95_eRo",
            authDomain: "kinaaeducation.firebaseapp.com",
            projectId: "kinaaeducation",
            storageBucket: "kinaaeducation.firebasestorage.app",
            messagingSenderId: "956734624041",
            appId: "1:956734624041:web:d5d3ca91b79a29eda82738",
            measurementId: "G-39P6ESD5LW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);

        // Current form state (SignIn or SignUp)
        let isSignUp = false;

        // Switch between SignUp and SignIn forms
        function toggleForms() {
            isSignUp = !isSignUp;
            const formTitle = document.getElementById("formTitle");
            const toggleText = document.getElementById("toggleText");

            if (isSignUp) {
                formTitle.textContent = "Kinaa Education - Sign Up";
                toggleText.textContent = "Already have an account? Sign In";
                document.getElementById('submitButton').textContent = "Sign Up";
            } else {
                formTitle.textContent = "Kinaa Education - Sign In";
                toggleText.textContent = "Don't have an account? Sign Up";
                document.getElementById('submitButton').textContent = "Sign In";
            }
        }

        // Handle Sign Up or Sign In based on the form state
        async function submitForm() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            // Validate inputs
            if (username === "" || password === "") {
                showErrorMessage("Both username and password are required.");
                return;
            }

            try {
                // Check if it's the admin login
                if (username === "thekinaa" && password === "1116") {
                    // Admin login, set admin status
                    localStorage.setItem("isLoggedIn", "true");
                    localStorage.setItem("isAdmin", "true");
                    localStorage.setItem("username", username);
                    window.location.href = "home.html"; // Redirect to home page
                    return;
                }

                // Handle Sign Up or Sign In based on the form state
                if (isSignUp) {
                    // Create new user (Sign Up)
                    const userCredential = await createUserWithEmailAndPassword(auth, username, password);
                    const user = userCredential.user;

                    // Add user data to Firestore (default as non-admin)
                    await setDoc(doc(db, "users", user.uid), {
                        isAdmin: false, // Set default to false (you can change this as per your requirements)
                        username: username,
                    });

                    localStorage.setItem("isLoggedIn", "true");
                    localStorage.setItem("isAdmin", "false");
                    localStorage.setItem("username", username);

                    window.location.href = "home.html"; // Redirect to home page
                } else {
                    // Sign In with existing user
                    const userCredential = await signInWithEmailAndPassword(auth, username, password);
                    const user = userCredential.user;

                    // Check Firestore for user data (isAdmin)
                    const docRef = doc(db, "users", user.uid);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        const userData = docSnap.data();
                        localStorage.setItem("isLoggedIn", "true");
                        localStorage.setItem("isAdmin", userData.isAdmin ? "true" : "false");
                        localStorage.setItem("username", username);

                        window.location.href = "home.html"; // Redirect to home page
                    } else {
                        // Optionally, if no data found, create a user record in Firestore (to be updated later)
                        await setDoc(doc(db, "users", user.uid), {
                            isAdmin: false, // Default value for new users
                            username: username,
                        });
                        localStorage.setItem("isLoggedIn", "true");
                        localStorage.setItem("isAdmin", "false");
                        localStorage.setItem("username", username);

                        window.location.href = "home.html"; // Redirect to home page
                    }
                }
            } catch (error) {
                showErrorMessage(error.message);
            }
        }

        // Show error message
        function showErrorMessage(message) {
            const errorContainer = document.getElementById('errorContainer');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorContainer.classList.remove('hidden');
        }

    </script>
</head>
<body class="bg-black text-blue-200 flex items-center justify-center h-screen">

    <div class="w-full max-w-xs">
        <div id="authFormContainer" class="bg-blue-800 shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <h2 id="formTitle" class="text-center text-xl mb-4">Kinaa Education - Sign In</h2>

            <!-- Error message container -->
            <div id="errorContainer" class="text-center mb-4 hidden">
                <p id="errorMessage" class="error-message text-red-500"></p>
            </div>
            
            <!-- Login / Sign Up Form -->
            <form id="loginForm" class="mb-4" onsubmit="event.preventDefault(); submitForm()">
                <div class="mb-4">
                    <label class="block text-sm font-bold mb-2" for="username">Username</label>
                    <input id="loginUsername" type="text" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" required>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-bold mb-2" for="password">Password</label>
                    <input id="loginPassword" type="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700" required>
                </div>
                <button type="submit" id="submitButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    Sign In
                </button>
            </form>

            <div class="mt-4 text-center">
                <p id="toggleText" class="text-sm cursor-pointer text-blue-300" onclick="toggleForms()">Don't have an account? Sign Up</p>
            </div>
        </div>
    </div>

</body>
</html>

